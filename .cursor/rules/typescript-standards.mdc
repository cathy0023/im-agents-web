---
globs: *.ts,*.tsx
---

# TypeScript å¼€å‘æ ‡å‡†

## ğŸ¯ ç±»å‹å®‰å…¨åŸåˆ™

### âœ… ä¸¥æ ¼ç±»å‹æ£€æŸ¥
```typescript
// âœ… æ˜ç¡®çš„ç±»å‹å®šä¹‰
interface User {
  id: string
  name: string
  email: string
  role: 'admin' | 'user'
}

// âœ… å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ç±»å‹
const getUserById = async (id: string): Promise<User | null> => {
  // å®ç°
}

// âœ… æ³›å‹ä½¿ç”¨
interface ApiResponse<T> {
  data: T
  success: boolean
  message?: string
}
```

### âŒ ç¦æ­¢çš„åšæ³•
```typescript
// âŒ ç¦æ­¢ä½¿ç”¨ any
const data: any = await response.json()

// âŒ ç¦æ­¢å¿½ç•¥ TypeScript é”™è¯¯
// @ts-ignore
const result = unsafeOperation()

// âŒ ç¦æ­¢æœªå®šä¹‰çš„ç±»å‹
const user = {} as User // ä¸å®‰å…¨çš„ç±»å‹æ–­è¨€
```

## ğŸ“‹ ç±»å‹å®šä¹‰è§„èŒƒ

### é›†ä¸­ç±»å‹ç®¡ç†
å‚è€ƒé¡¹ç›®ç»“æ„ [src/types/](mdc:src/types/):
- [src/types/chat.ts](mdc:src/types/chat.ts) - èŠå¤©ç›¸å…³ç±»å‹
- [src/i18n/types.ts](mdc:src/i18n/types.ts) - å›½é™…åŒ–ç›¸å…³ç±»å‹
- å°†ç›¸å…³ç±»å‹æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­
- ä½¿ç”¨ `export` å¯¼å‡ºæ‰€æœ‰ç±»å‹

### å›½é™…åŒ–ç±»å‹å®šä¹‰
```typescript
// âœ… å›½é™…åŒ–ç›¸å…³ç±»å‹
export type Language = 'zh' | 'en' | 'ar'
export type TranslationNamespace = 'common' | 'chat' | 'agents' | 'ui'

export interface LanguageConfig {
  code: Language
  name: string
  nativeName: string
  dir: 'ltr' | 'rtl'
  flag: string
}

// âœ… å›½é™…åŒ– Hook è¿”å›ç±»å‹
interface UseI18nReturn {
  t: (key: string, options?: any) => string
  currentLanguage: Language
  changeLanguage: (lang: Language) => Promise<void>
  isRTL: boolean
  textDirection: 'ltr' | 'rtl'
  languageConfig: LanguageConfig
  isLoading: boolean
}
```

### Interface vs Type
```typescript
// âœ… ä¼˜å…ˆä½¿ç”¨ interfaceï¼ˆå¯æ‰©å±•ï¼‰
interface ChatMessage {
  id: string
  content: string
  role: 'user' | 'assistant'
  timestamp: Date
}

// âœ… å¤æ‚ç±»å‹ä½¿ç”¨ type
type ChatState = {
  messages: ChatMessage[]
  isLoading: boolean
} & BaseState

// âœ… è”åˆç±»å‹ä½¿ç”¨ type
type MessageRole = 'user' | 'assistant' | 'system'
```

## ğŸ”§ å·¥å…·ç±»å‹ä½¿ç”¨

### å¸¸ç”¨å·¥å…·ç±»å‹
```typescript
// âœ… Partial ç”¨äºå¯é€‰å±æ€§
const updateUser = (id: string, updates: Partial<User>) => {
  // å®ç°
}

// âœ… Pick é€‰æ‹©ç‰¹å®šå±æ€§
type UserSummary = Pick<User, 'id' | 'name'>

// âœ… Omit æ’é™¤ç‰¹å®šå±æ€§
type CreateUserRequest = Omit<User, 'id'>

// âœ… Record åˆ›å»ºæ˜ å°„ç±»å‹
type UserRoles = Record<string, 'admin' | 'user'>
```

## ğŸ¨ React + TypeScript æœ€ä½³å®è·µ

### ç»„ä»¶ Props å®šä¹‰ï¼ˆåŒ…å«å›½é™…åŒ–ï¼‰
```typescript
// âœ… å®Œæ•´çš„ Props æ¥å£ + å›½é™…åŒ–æ”¯æŒ
interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'outline'
  size?: 'sm' | 'md' | 'lg'
  isLoading?: boolean
  children: React.ReactNode
  // å›½é™…åŒ–ç›¸å…³
  translationKey?: string
  namespace?: TranslationNamespace
}

// âœ… å›½é™…åŒ–ç»„ä»¶ Props
interface I18nComponentProps {
  title: string
  children?: React.ReactNode
  className?: string
  // å›½é™…åŒ–æ”¯æŒ
  titleKey?: string
  namespace?: TranslationNamespace
  isRTL?: boolean
  textDirection?: 'ltr' | 'rtl'
}

// âœ… å¯é€‰ children
interface CardProps {
  title: string
  children?: React.ReactNode
  className?: string
}
```

### äº‹ä»¶å¤„ç†ç±»å‹
```typescript
// âœ… æ­£ç¡®çš„äº‹ä»¶ç±»å‹
const handleSubmit = (event: React.FormEvent<HTMLFormElement>) => {
  event.preventDefault()
  // å¤„ç†è¡¨å•æäº¤
}

const handleInputChange = (event: React.ChangeEvent<HTMLInputElement>) => {
  setValue(event.target.value)
}

const handleButtonClick = (event: React.MouseEvent<HTMLButtonElement>) => {
  // å¤„ç†æŒ‰é’®ç‚¹å‡»
}
```

### Ref ç±»å‹
```typescript
// âœ… forwardRef ç±»å‹
const MyComponent = forwardRef<HTMLDivElement, MyComponentProps>(
  (props, ref) => {
    return <div ref={ref} {...props} />
  }
)

// âœ… useRef ç±»å‹
const inputRef = useRef<HTMLInputElement>(null)
const divRef = useRef<HTMLDivElement>(null)
```

## ğŸ”„ çŠ¶æ€ç®¡ç†ç±»å‹

### zustand Store ç±»å‹
å‚è€ƒ [src/store/chatStore.ts](mdc:src/store/chatStore.ts):
```typescript
// âœ… Store çŠ¶æ€æ¥å£
interface ChatState {
  // çŠ¶æ€
  messages: Message[]
  isLoading: boolean
  apiKey: string | null
  
  // åŠ¨ä½œ (æ˜ç¡®å‚æ•°å’Œè¿”å›ç±»å‹)
  addMessage: (message: Message) => void
  setLoading: (loading: boolean) => void
  clearMessages: () => void
}

// âœ… ä½¿ç”¨ç±»å‹å®‰å…¨çš„ create
const useChatStore = create<ChatState>((set, get) => ({
  // å®ç°
}))
```

## ğŸŒ API ç±»å‹å®šä¹‰

### API å“åº”ç±»å‹
å‚è€ƒ [src/lib/api.ts](mdc:src/lib/api.ts):
```typescript
// âœ… API å“åº”æ¥å£
interface ApiResponse<T = any> {
  data: T
  success: boolean
  message?: string
  error?: string
}

// âœ… å…·ä½“çš„APIç±»å‹
interface SendMessageResponse {
  messageId: string
  content: string
  timestamp: string
}

// âœ… é”™è¯¯å¤„ç†ç±»å‹
interface ApiError {
  code: string
  message: string
  details?: Record<string, any>
}
```

### API å‡½æ•°ç±»å‹
```typescript
// âœ… æ˜ç¡®çš„å‡½æ•°ç­¾å
const sendMessage = async (
  message: string,
  agentId: number
): Promise<ApiResponse<SendMessageResponse>> => {
  // å®ç°
}

// âœ… é”™è¯¯å¤„ç†
const handleApiError = (error: unknown): ApiError => {
  if (error instanceof Error) {
    return { code: 'UNKNOWN_ERROR', message: error.message }
  }
  return { code: 'UNEXPECTED_ERROR', message: 'An unexpected error occurred' }
}
```

## ğŸ” ç±»å‹ç¼©çª„å’Œå®ˆå«

### ç±»å‹å®ˆå«
```typescript
// âœ… ç”¨æˆ·å®šä¹‰çš„ç±»å‹å®ˆå«
const isMessage = (value: unknown): value is Message => {
  return (
    typeof value === 'object' &&
    value !== null &&
    'id' in value &&
    'content' in value &&
    'role' in value
  )
}

// âœ… ä½¿ç”¨ç±»å‹å®ˆå«
if (isMessage(data)) {
  // data ç°åœ¨æ˜¯ Message ç±»å‹
  console.log(data.content)
}
```

### å¯é€‰é“¾å’Œç©ºå€¼åˆå¹¶
```typescript
// âœ… å®‰å…¨çš„å±æ€§è®¿é—®
const userName = user?.profile?.name ?? 'Unknown'

// âœ… æ•°ç»„å®‰å…¨è®¿é—®
const firstMessage = messages?.[0]?.content
```

## ğŸ“ æ³¨é‡Šå’Œæ–‡æ¡£

### JSDoc æ³¨é‡Š
```typescript
/**
 * å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„AIåŠ©æ‰‹
 * @param message - è¦å‘é€çš„æ¶ˆæ¯å†…å®¹
 * @param agentId - ç›®æ ‡åŠ©æ‰‹ID
 * @returns Promise åŒ…å«å“åº”æ•°æ®
 * @throws {ApiError} å½“APIè°ƒç”¨å¤±è´¥æ—¶
 */
const sendMessage = async (
  message: string, 
  agentId: number
): Promise<ApiResponse<SendMessageResponse>> => {
  // å®ç°
}
```

## âš¡ æ€§èƒ½ç›¸å…³ç±»å‹

### å›è°ƒå‡½æ•°ç±»å‹ä¼˜åŒ–
```typescript
// âœ… useCallback ç±»å‹
const handleSubmit = useCallback(
  (data: FormData) => {
    // å¤„ç†é€»è¾‘
  },
  [dependency]
)

// âœ… useMemo ç±»å‹
const expensiveValue = useMemo(
  (): ComputedType => computeExpensiveValue(data),
  [data]
)
```